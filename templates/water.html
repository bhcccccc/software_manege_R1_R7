<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>æ™ºæ…§æµ·æ´‹ç‰§åœº - æ°´ä¸‹ç•Œé¢</title>
  <style>
    body {
      margin: 0;
      font-family: "Microsoft YaHei", sans-serif;
      background-color: #001f3f;
      color: #fff;
    }

    /* é¡¶éƒ¨å¯¼èˆªæ æ ·å¼ */
    .navbar {
      background-color: #003366;
      padding: 15px 30px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }

    .navbar h1 {
      color: white;
      font-size: 22px;
      margin: 0;
      font-weight: 600;
    }

    .navbar ul {
      display: flex;
      list-style: none;
      margin: 0;
      padding: 0;
      align-items: center;
    }

    .navbar ul li {
      margin: 0 15px;
    }

    .navbar ul li a {
      color: white;
      text-decoration: none;
      font-size: 15px;
      font-weight: 500;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
    }

    .navbar ul li a:hover {
      color: #66ccff;
    }

    .username {
      color: white;
      margin-right: 20px;
      font-weight: 500;
    }



    .exit {
      margin-left: 20px;
    }

    .main-image {
      width: 100%;
      height: 100vh;
      background-image: url("/static/img/fishes.png");
      background-size: cover;
      background-position: center;
      position: relative;
    }

    .header-info {
      position: absolute;
      top: 380px;
      left: 30px;
      background: rgba(0, 51, 102, 0.8);
      padding: 15px;
      border-radius: 10px;
      font-size: 14px;
      line-height: 1.6;
    }

    .overlay-top {
      position: absolute;
      top: 370px;
      right: 30px;
      text-align: right;
      font-size: 16px;
    }

    /* æ“ä½œåŒºèƒŒæ™¯å’Œå¸ƒå±€ */
    .overlay-ops {
      margin-top: 10px;
      margin-bottom: 20px;
      padding: 10px;
      background: #f9f9f9;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      max-width: 400px;
      float: right;
      color: black; /* æ•´ä½“æ–‡å­—å˜é»‘ */
    }

    /* æ ‡é¢˜å’Œæ ‡ç­¾æ–‡å­—å˜é»‘ */
    .overlay-ops h4,
    .overlay-ops label {
      color: black;
    }

    /* ä¸‹è½½æŒ‰é’® */
    .overlay-ops a {
      padding: 8px 16px;
      background-color: #009933;
      color: white;
      border-radius: 5px;
      text-decoration: none;
      font-weight: 600;
      font-size: 14px;
      display: inline-block;
      text-align: center;
    }

    /* ä¸Šä¼ åŒºåŸŸæ ·å¼ */
    .overlay-ops > div:nth-child(2) {
      margin-bottom: 15px;
      background: #f0f8ff;
      border: 1px solid #0066cc;
      border-radius: 6px;
      padding: 10px;
    }

    /* åˆ é™¤åŒºåŸŸæ ·å¼ */
    .overlay-ops > div:nth-child(3) {
      background: #fff0f0;
      border: 1px solid #cc0000;
      border-radius: 6px;
      padding: 10px;
    }

    .fish-image-box {
      position: absolute;
      top: 58%;
      left: 50%;
      transform: translate(-50%, -50%);
      text-align: center;
    }

    .fish-image-box img {
      width: 400px;
      border-radius: 10px;
      border: 2px solid #00ccff;
    }

    .bottom-info {
      position: absolute;
      bottom: 20px;
      left: 50%;  
      transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.6);
      padding: 20px 30px;
      border-radius: 12px;
      display: flex;
      gap: 40px;
      align-items: center;
    }

    .bottom-info div {
      text-align: center;
    } 

    .fish-buttons {
      margin-top: 360px;
      display: flex;
      justify-content: center;
      gap: 15px;
      transform: translateX(150px);
    }

    .fish-buttons button {
      background: #0077ff;
      border: none;
      padding: 8px 14px;
      border-radius: 6px;
      color: #fff;
      cursor: pointer;
      font-size: 14px;
    }

    .fish-buttons button.active {
      background: #00ccff;
    }

    .fish-data-section {
      clear: both; /* æ¸…é™¤æµ®åŠ¨å½±å“ */
      margin: 40px auto 0;
      max-width: 900px;
      background: rgba(0, 0, 0, 0.45);
      padding: 20px;
      border-radius: 12px;
      color: #fff;
      position: relative;
      z-index: 1;
    }

    .fish-data-section h3 {
      text-align: center;
      margin-bottom: 15px;
      color: #00ccff;
    }

    .fish-table-scroll {
      max-height: 300px;
      overflow-y: auto;
      border: 1px solid #004c99;
      border-radius: 8px;
    }

    .fish-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 13px;
    }

    .fish-table thead {
      background-color: #002244;
      position: sticky;
      top: 0;
      z-index: 2;
    }

    .fish-table th, .fish-table td {
      padding: 8px 10px;
      border-bottom: 1px solid #004c99;
      text-align: center;
      background-color: rgba(0, 0, 0, 0.15);
      color: #fff;
    }

    .fish-table tbody tr:hover {
      background-color: rgba(0, 102, 204, 0.3);
    }


  </style>
</head>
<body>
  <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
  <div class="navbar">
    <div><h1>æµ·æ´‹ç‰§åœºç›‘æµ‹ç³»ç»Ÿ</h1></div>
    <ul>
      <li><a href="{{ url_for('tomain') }}">é¦–é¡µ</a></li>
      <li><a href="{{ url_for('todata') }}">ä¸»è¦ä¿¡æ¯</a></li>
      <li><a href="{{ url_for('towater') }}">æ°´ä¸‹ç³»ç»Ÿ</a></li>
      <li><a href="{{ url_for('toai') }}">æ™ºèƒ½ä¸­å¿ƒ</a></li>
      {% if userrole == "admin" %}
      <li><a href="{{ url_for('toadadmin') }}">ç®¡ç†å‘˜</a></li>
      {% endif %}
    </ul>
    <ul>
      <li><a href="{{ url_for('topersonal') }}" class="username">{{ username }}</a></li>
      <li class="exit"><a href="{{ url_for('exit') }}">é€€å‡º</a></li>
    </ul>
  </div>

  <!-- ä¸»ç•Œé¢å›¾å±‚ -->
  <div class="main-image">
    <!-- å·¦ä¸Šè§’ç¡¬ä»¶ä¿¡æ¯ -->
    <div class="header-info">
      <strong>ç¡¬ä»¶ä¿¡æ¯</strong><br>
      ç½‘ç®±ï¼š100mÃ—50mÃ—30mï¼Œåæ ‡(ç»:128.034ï¼Œçº¬:56.123)<br>
      æ°´åº•ä¼ æ„Ÿå™¨ï¼šè¿è¡Œ 0å¤©23å°æ—¶59åˆ†é’Ÿ<br>
      ä¸‹æ¬¡æ£€ä¿®ï¼š35.0 å¤©å<br>
      ä¿ä¿®è¿‡æœŸï¼š2035å¹´02æœˆ01æ—¥
    </div>

  <div class="fish-table-container">
    <h3>ğŸŸ é±¼ç±»æ•°æ®ä¸€è§ˆè¡¨</h3>
    <div class="fish-table-scroll">
      <table class="fish-table">
        <thead>
          <tr>
            <th>Fish ID</th>
            <th>ç±»å‹</th>
            <th>é‡é‡</th>
            <th>é•¿åº¦1</th>
            <th>é•¿åº¦2</th>
            <th>é•¿åº¦3</th>
            <th>é«˜åº¦</th>
            <th>å®½åº¦</th>
          </tr>
        </thead>
        <tbody>
          {% for row in all_fish_records %}
          <tr>
            <td>{{ row.fishid }}</td>
            <td>{{ row.type }}</td>
            <td>{{ row.weight }}</td>
            <td>{{ row.length1 }}</td>
            <td>{{ row.length2 }}</td>
            <td>{{ row.length3 }}</td>
            <td>{{ row.height }}</td>
            <td>{{ row.width }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>





    <!-- å³ä¸Šè§’æ—¶é—´å’Œæ¸©åº¦ -->
    <div class="overlay-top">
      <div id="current-time">æ—¶é—´ï¼š</div>
      <div id="current-temp">æ¸©åº¦ï¼š-- Â°C</div>
      <div>æµ·æ´‹ç‰§åœº - ä¸€å·èˆ±</div>
    </div>

    <!-- ç´§æ¥å…¶ä¸‹çš„æ“ä½œåŠŸèƒ½åŒºï¼šä¸‹è½½ / ä¸Šä¼  / åˆ é™¤ -->
    <div class="overlay-ops" style="margin-top: 200px; margin-bottom: 20px; padding: 10px; background: #f9f9f9; border-radius: 8px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); max-width: 400px; float: right;">

      <!-- ä¸‹è½½æŒ‰é’®ï¼ˆæ‰€æœ‰ç”¨æˆ·å¯è§ï¼‰ -->
      <div style="margin-bottom: 10px; text-align: right;">
        <a href="{{ url_for('download_fish_data') }}" 
          style="padding: 8px 16px; background-color:#009933; color:black; border-radius: 5px; text-decoration: none; font-weight: 600; font-size: 14px;">
          ä¸‹è½½é±¼ç±»æ•°æ® CSV
        </a>
      </div>

      <!-- ä¸Šä¼ /åˆ é™¤ä»…ç®¡ç†å‘˜å¯è§ -->
      {% if userrole == 'admin' %}
      <!-- ä¸Šä¼ æ•°æ® -->
      <div style="margin-bottom: 15px; background: #f0f8ff; border: 1px solid #0066cc; border-radius: 6px; padding: 10px;">
        <h4 style="margin: 0 0 8px;">ä¸Šä¼ é±¼ç±»æ•°æ®ï¼ˆCSVï¼‰</h4>
        <form action="{{ url_for('upload_fish_data') }}" method="post" enctype="multipart/form-data">
          <input type="file" name="file" accept=".csv" required style="margin-bottom: 6px;">
          <button type="submit" style="padding: 6px 12px; background-color:#0066cc; color:black; border:none; border-radius: 4px;">ä¸Šä¼ </button>
        </form>
      </div>

      <!-- åˆ é™¤æ•°æ® -->
      <div style="background: #fff0f0; border: 1px solid #cc0000; border-radius: 6px; padding: 10px;">
        <h4 style="margin: 0 0 8px;">åˆ é™¤é±¼ç±»æ•°æ®</h4>
        <form action="{{ url_for('delete_fish_data') }}" method="post" onsubmit="return confirm('ç¡®è®¤åˆ é™¤å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼');">
          <label for="fishid" style="font-size: 14px;">Fish ID:</label>
          <input type="text" id="fishid" name="fishid" required style="margin-left: 8px; padding: 4px; width: 100px;">
          <button type="submit" style="padding: 6px 12px; background-color:#cc0000; color:black; border:none; border-radius: 4px; margin-left: 10px;">åˆ é™¤</button>
        </form>
      </div>
      {% endif %}
    </div>

    <!-- ä¸­é—´é±¼å›¾ -->
    <div class="fish-image-box">
      <img id="fishImage" src="/static/img/fish.png" alt="é±¼ç±»å›¾ç‰‡">
      <div style="margin-top: 5px;">å½“å‰é±¼ç§å›¾</div>
    </div>

    <!-- åº•éƒ¨ä¿¡æ¯ -->
    <div class="bottom-info">
      <div>
        <div id="selectedType">é±¼ç§ï¼šé²¤é±¼</div>
        <div>æ•°é‡ï¼š<span id="fishCount">--</span></div>
        <div>å¹³å‡é•¿åº¦ï¼š<span id="avgLength">--</span></div>
        <div>å¹³å‡é«˜åº¦ï¼š<span id="avgHeight">--</span></div>
      </div>
      <div>
        <div>æ€»é±¼æ•°ï¼š<span>{{ total_fish }}</span></div> 
      </div>
      <div>
        <div>ç¯å¢ƒæ„ŸçŸ¥å¾—åˆ†</div>
        <div style="font-size: 32px; font-weight: bold;">{{ env_score }}</div>
      </div>
    </div>

    <!-- é±¼ç±»é€‰æ‹©æŒ‰é’® -->
    <div class="fish-buttons">
      {% for t in fish_types %}
      <button onclick="showFish('{{ t }}')" id="btn_{{ t }}">{{ t }}</button>
      {% endfor %}
    </div>
  </div>

  <!-- JavaScript éƒ¨åˆ† -->
  <script>
    const fishData = {{ fish_data|tojson }};
    let currentType = "{{ fish_types[0] }}";

    function showFish(type) {
      currentType = type;
      document.getElementById('selectedType').textContent = 'é±¼ç§ï¼š' + type;
      document.querySelectorAll('.fish-buttons button').forEach(btn => {
        btn.classList.remove('active');
      });
      document.getElementById('btn_' + type).classList.add('active');

      const fishList = fishData[type];
      if (fishList.length === 0) {
        document.getElementById('fishCount').textContent = '0';
        document.getElementById('avgLength').textContent = '--';
        document.getElementById('avgHeight').textContent = '--';
        return;
      }

      document.getElementById('fishCount').textContent = fishList.length;
      const avgLength = (fishList.reduce((s, f) => s + f.length, 0) / fishList.length).toFixed(2);
      const avgHeight = (fishList.reduce((s, f) => s + f.height, 0) / fishList.length).toFixed(2);
      document.getElementById('avgLength').textContent = avgLength + ' cm';
      document.getElementById('avgHeight').textContent = avgHeight + ' cm';

      // æ›´æ¢é±¼å›¾
      document.getElementById('fishImage').src = "/static/img/fish_images/" + type + ".png";
    }

    // æ—¶é—´ä¸æ¸©åº¦æ›´æ–°
    function updateTimeAndTemp() {
      const now = new Date();
      const timeStr = now.toLocaleString('zh-CN', { hour12: false });
      document.getElementById('current-time').textContent = 'æ—¶é—´ï¼š' + timeStr;

      const temp = (12 + Math.random() * 3).toFixed(1); // 12.0 ~ 15.0Â°C éšæœºæ³¢åŠ¨
      document.getElementById('current-temp').textContent = 'æ¸©åº¦ï¼š' + temp + 'Â°C';
    }

    setInterval(updateTimeAndTemp, 1000);
    updateTimeAndTemp();
    showFish(currentType);
  </script>
</body>
</html>
